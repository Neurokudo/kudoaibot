# KudoAiBot - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

## üìã –û–±–∑–æ—Ä

KudoAiBot - –º–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π AI-–±–æ—Ç –¥–ª—è Telegram —Å —Ç—Ä–µ–º—è –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏:
- üé¨ **–í–ò–î–ï–û** (SORA 2 –∏ VEO 3)
- üì∏ **–§–û–¢–û** (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
- üëó **–ü–†–ò–ú–ï–†–û–ß–ù–ê–Ø** (–≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∏–º–µ—Ä–æ—á–Ω–∞—è)

## üéØ –†–µ–∂–∏–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ

–ö–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å (SORA 2 –∏ VEO 3) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 3 —Ä–µ–∂–∏–º–∞:

### ü§ñ –£–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∏–¥–µ—é –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
- GPT-4o-mini —Å–æ–∑–¥–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- –ü—Ä–æ–º–ø—Ç –≤–∫–ª—é—á–∞–µ—Ç: –ø–µ—Ä—Å–æ–Ω–∞–∂, –æ–∫—Ä—É–∂–µ–Ω–∏–µ, –∫–∞–º–µ—Ä—É, –æ—Å–≤–µ—â–µ–Ω–∏–µ, —Å—Ç–∏–ª—å

### ‚úã –†—É—á–Ω–æ–π —Ä–µ–∂–∏–º
- –î–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä—è–º–æ–π –≤–≤–æ–¥ –≥–æ—Ç–æ–≤–æ–≥–æ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º

### üòÑ –ú–µ–º–Ω—ã–π —Ä–µ–∂–∏–º
- –ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –º–µ–º–Ω—ã—Ö –≤–∏–¥–µ–æ (6 —Å–µ–∫—É–Ω–¥)
- GPT —Å–æ–∑–¥–∞–µ—Ç —é–º–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: 9:16, –±–µ–∑ –∑–≤—É–∫–∞

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
KudoAiBot/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ config/           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–∞—Ä–∏—Ñ—ã, —Ü–µ–Ω—ã)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pricing.py
‚îÇ   ‚îú‚îÄ‚îÄ db/              # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ subscriptions.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transactions.py
‚îÇ   ‚îú‚îÄ‚îÄ handlers/        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ states.py    # –°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ video_handlers.py  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∏–¥–µ–æ
‚îÇ   ‚îú‚îÄ‚îÄ services/        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clients/     # API –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ veo_client.py    # VEO 3 (Google)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sora_client.py   # SORA 2 (OpenAI)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tryon_client.py  # –ü—Ä–∏–º–µ—Ä–æ—á–Ω–∞—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai_helper.py         # GPT –ø–æ–º–æ—â–Ω–∏–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ balance_manager.py   # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ billing.py           # –ë–∏–ª–ª–∏–Ω–≥
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ yookassa_service.py  # –ü–ª–∞—Ç–µ–∂–∏
‚îÇ   ‚îî‚îÄ‚îÄ ui/              # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ callbacks.py # –°–∏—Å—Ç–µ–º–∞ callback –¥–∞–Ω–Ω—ã—Ö
‚îÇ       ‚îú‚îÄ‚îÄ keyboards.py # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ       ‚îî‚îÄ‚îÄ texts.py     # –¢–µ–∫—Å—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îú‚îÄ‚îÄ main.py              # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –±–æ—Ç–∞
‚îî‚îÄ‚îÄ requirements.txt     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## üîÑ –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ —É–º–Ω–æ–≥–æ –ø–æ–º–æ—â–Ω–∏–∫–∞:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç: –í–ò–î–ï–û ‚Üí VEO 3 ‚Üí ü§ñ –° –ø–æ–º–æ—â–Ω–∏–∫–æ–º
2. –í–≤–æ–¥–∏—Ç –ø—Ä–æ—Å—Ç–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ: "—Å–æ–±–∞–∫–∞ –±–µ–∂–∏—Ç –ø–æ –ø–∞—Ä–∫—É"
3. GPT —É–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–º–ø—Ç: "A golden retriever dog running joyfully through a sunny park..."
4. –í—ã–±–æ—Ä –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏: 9:16 –∏–ª–∏ 16:9
5. –í—ã–±–æ—Ä –∞—É–¥–∏–æ: —Å–æ –∑–≤—É–∫–æ–º –∏–ª–∏ –±–µ–∑
6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (1-2 –º–∏–Ω—É—Ç—ã)
7. –†–µ–∑—É–ª—å—Ç–∞—Ç + –∫–Ω–æ–ø–∫–∏: üîÑ –ï—â–µ —Ä–∞–∑ | üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

### –ú–µ–º–Ω—ã–π —Ä–µ–∂–∏–º:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –í–ò–î–ï–û ‚Üí VEO 3 ‚Üí üòÑ –ú–µ–º
2. –í–≤–æ–¥–∏—Ç —Ç–µ–º—É: "–∫–æ—Ç –Ω–∞ —Å–∫–µ–π—Ç–µ"
3. GPT —Å–æ–∑–¥–∞–µ—Ç –º–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (6 —Å–µ–∫, 9:16, –±–µ–∑ –∑–≤—É–∫–∞)
5. –†–µ–∑—É–ª—å—Ç–∞—Ç

## üé® –°–∏—Å—Ç–µ–º–∞ UI

### Callbacks
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ callback –¥–∞–Ω–Ω—ã—Ö: `action|id|extra`

–ü—Ä–∏–º–µ—Ä—ã:
- `nav|video` - –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —Ä–∞–∑–¥–µ–ª—É –≤–∏–¥–µ–æ
- `mode_helper|veo3` - —Ä–µ–∂–∏–º –ø–æ–º–æ—â–Ω–∏–∫–∞ –¥–ª—è VEO 3
- `ori_916` - –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è

### –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
```python
UserState {
    user_id: int
    current_screen: str       # –¢–µ–∫—É—â–∏–π —ç–∫—Ä–∞–Ω
    video_model: str          # "veo3" –∏–ª–∏ "sora2"
    video_mode: str           # "helper", "manual", "meme"
    waiting_for: str          # –û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞
    video_params: dict        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∏–¥–µ–æ
    last_prompt: str          # –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ–º–ø—Ç
}
```

## üîß API –∫–ª–∏–µ–Ω—Ç—ã

### VEO 3 (Google)
```python
generate_video_veo3_async(
    prompt: str,
    duration: int = 8,           # 6 –∏–ª–∏ 8 —Å–µ–∫—É–Ω–¥
    aspect_ratio: str = "9:16",  # 9:16 –∏–ª–∏ 16:9
    with_audio: bool = True
)
```

### SORA 2 (OpenAI)
```python
generate_video_sora2_async(
    prompt: str,
    duration: int = 8,
    aspect_ratio: str = "9:16",
    with_audio: bool = True
)
```
*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: SORA 2 –ø–æ–∫–∞ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω (–∑–∞–≥–ª—É—à–∫–∞)*

### AI –ü–æ–º–æ—â–Ω–∏–∫ (GPT)
```python
improve_prompt_async(
    user_input: str,
    mode: str = "helper"  # "helper" –∏–ª–∏ "meme"
)
```

## üí∞ –ë–∏–ª–ª–∏–Ω–≥

### –°—Ç–æ–∏–º–æ—Å—Ç—å (–≤ –º–æ–Ω–µ—Ç–∫–∞—Ö)
- –í–∏–¥–µ–æ 8 —Å–µ–∫ –±–µ–∑ –∑–≤—É–∫–∞: 18 –º–æ–Ω–µ—Ç–æ–∫
- –í–∏–¥–µ–æ 8 —Å–µ–∫ —Å–æ –∑–≤—É–∫–æ–º: 22 –º–æ–Ω–µ—Ç–∫–∏
- –í–∏–¥–µ–æ 6 —Å–µ–∫ (–º–µ–º—ã): 14 –º–æ–Ω–µ—Ç–æ–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞
```python
access = await billing.check_access(user_id, "video_8s_mute")
if access['access']:
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∞
```

### –°–ø–∏—Å–∞–Ω–∏–µ –º–æ–Ω–µ—Ç–æ–∫
```python
result = await billing.deduct_coins_for_feature(user_id, "video_8s_mute")
```

## üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
BOT_TOKEN=your_telegram_bot_token
DATABASE_URL=postgresql://...
OPENAI_API_KEY=sk-...
GCP_PROJECT_ID=your-project-id
GCP_KEY_JSON_B64=base64_encoded_key
YOOKASSA_SHOP_ID=...
YOOKASSA_SECRET_KEY=...
PUBLIC_URL=https://your-domain.com  # –¥–ª—è webhook
TELEGRAM_MODE=webhook  # –∏–ª–∏ polling
```

### –ó–∞–ø—É—Å–∫
```bash
python main.py
```

## üìù TODO

### SORA 2
- [ ] –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ SORA 2 API
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç sora_client.py
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

### –§–û–¢–û
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–∞ –§–û–¢–û
- [ ] –°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI –º–æ–¥–µ–ª—è–º–∏

### –ü–†–ò–ú–ï–†–û–ß–ù–ê–Ø
- [ ] –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –ø—Ä–∏–º–µ—Ä–æ—á–Ω—É—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å IDM-VTON

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏
2. **–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
3. **AI –ø–æ–º–æ—â–Ω–∏–∫** - —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ —á–µ—Ä–µ–∑ GPT
4. **–ì–∏–±–∫–∞—è –±–∏–ª–ª–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–∞** - –º–æ–Ω–µ—Ç–∫–∏ + –ø–æ–¥–ø–∏—Å–∫–∏
5. **Graceful shutdown** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
6. **Webhook + Polling** - –¥–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

## üìö –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

1. –î–æ–±–∞–≤–∏—Ç—å action –≤ `app/ui/callbacks.py`:
```python
MODE_CUSTOM = "mode_custom"
```

2. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –≤ `app/ui/texts.py`:
```python
"btn.mode_custom": "‚≠ê –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ä–µ–∂–∏–º"
```

3. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `app/handlers/video_handlers.py`:
```python
async def handle_mode_custom(callback: CallbackQuery):
    # –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
```

4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `main.py`:
```python
@dp.callback_query(F.data == Actions.MODE_CUSTOM)
async def callback_mode_custom(callback: CallbackQuery):
    await handle_mode_custom(callback)
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏
–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `logs/bot.log` (–µ—Å–ª–∏ `LOG_TO_FILE=true`)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```python
from app.handlers.states import get_user_state
state = get_user_state(user_id)
print(state)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
```bash
python -c "from app.db import users; import asyncio; asyncio.run(users.get_user(USER_ID))"
```

---

**–ê–≤—Ç–æ—Ä:** KudoAI Team
**–î–∞—Ç–∞:** 2025-01-20
**–í–µ—Ä—Å–∏—è:** 2.0

